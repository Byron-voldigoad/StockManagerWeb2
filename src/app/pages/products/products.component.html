<app-public-layout>
  <div class="min-h-screen bg-slate-50">
    <main class="container mx-auto px-4 py-8">
      <!-- En-tête -->
      <div class="mb-8">
        <h1 class="text-4xl font-bold mb-2 text-slate-900">
          {{ configService.getSetting("products_title") || "Notre Collection" }}
        </h1>
        <p class="text-slate-600">
          {{
            configService.getSetting("products_subtitle") ||
              "Découvrez nos trésors vintage et antiquités"
          }}
        </p>
      </div>

      <!-- NOUVEAU : Section Filtres et Recherche -->
      <div
        class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-8"
      >
        <div
          class="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between"
        >
          <!-- Barre de recherche -->
          <div class="flex-1 w-full lg:max-w-md">
            <label class="block text-sm font-medium text-slate-700 mb-2">
              {{ configService.getSetting("search_label") || "Rechercher" }}
            </label>
            <div class="relative">
              <input
                type="text"
                [(ngModel)]="searchQuery"
                (input)="onSearchChange()"
                placeholder="{{
                  configService.getSetting('search_placeholder') ||
                    'Nom, description...'
                }}"
                class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200"
              />
              <svg
                class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
            </div>
          </div>

          <!-- Filtre par catégorie -->
          <div class="w-full lg:w-auto">
            <label class="block text-sm font-medium text-slate-700 mb-2">
              {{
                configService.getSetting("category_filter_label") || "Catégorie"
              }}
            </label>
            <select
              [(ngModel)]="selectedCategory"
              (change)="onCategoryChange()"
              class="w-full lg:w-48 px-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200"
            >
              <option value="Tous">
                {{
                  configService.getSetting("all_categories") ||
                    "Toutes les catégories"
                }}
              </option>
              <option *ngFor="let category of categories" [value]="category">
                {{ category }}
              </option>
            </select>
          </div>

          <!-- Filtre par prix - VERSION CORRIGÉE -->
          <div class="w-full lg:w-auto">
            <label class="block text-sm font-medium text-slate-700 mb-2">
              {{
                configService.getSetting("price_filter_label") ||
                  "Plage de prix"
              }}
            </label>
            <select [(ngModel)]="selectedPriceRange"
              (change)="onPriceChange()" class="w-full lg:w-48 px-4 py-3 border
              border-slate-300 rounded-lg focus:outline-none focus:ring-2
              focus:ring-blue-500 focus:border-transparent transition-colors
              duration-200" >
              <option value="">Toutes les fourchettes</option>
              <option value="0-20000">Moins de 20 000 FCFA</option>
              <option value="20000-50000">20 000 - 50 000 FCFA</option>
              <option value="50000-100000">50 000 - 100 000 FCFA</option>
              <option value="100000+">Plus de 100 000 FCFA</option>
            </select>
          </div>

          <!-- Bouton reset -->
          <div class="w-full lg:w-auto flex items-end">
            <button
              (click)="resetFilters()"
              class="w-full lg:w-auto px-4 py-3 text-slate-600 hover:text-slate-800 border border-slate-300 rounded-lg hover:bg-slate-50 transition-colors duration-200 font-medium"
            >
              {{ configService.getSetting("reset_filters") || "Réinitialiser" }}
            </button>
          </div>
        </div>

        <!-- Indicateur de résultats -->
        <div *ngIf="!isLoading" class="mt-4 flex items-center justify-between">
          <p class="text-sm text-slate-600">
            {{ filteredProducts.length }}
            {{
              configService.getSetting("products_found") || "produits trouvés"
            }}
          </p>

          <!-- Filtres actifs -->
          <div *ngIf="hasActiveFilters" class="flex items-center gap-2">
            <span class="text-xs text-slate-500">Filtres actifs :</span>
            <div class="flex flex-wrap gap-1">
              <span
                *ngIf="selectedCategory !== 'Tous'"
                class="inline-flex items-center gap-1 bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full"
              >
                {{ selectedCategory }}
                <button
                  (click)="removeCategoryFilter()"
                  class="hover:text-blue-600"
                >
                  ×
                </button>
              </span>
              <span
  *ngIf="selectedPriceRange"
  class="inline-flex items-center gap-1 bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full"
>
  {{ getPriceRangeDisplay() }}  <!-- ← CORRIGÉ ICI -->
  <button
    (click)="removePriceFilter()"
    class="hover:text-green-600"
  >
    ×
  </button>
</span>
              <span
                *ngIf="searchQuery"
                class="inline-flex items-center gap-1 bg-amber-100 text-amber-800 text-xs px-2 py-1 rounded-full"
              >
                "{{ searchQuery }}"
                <button
                  (click)="removeSearchFilter()"
                  class="hover:text-amber-600"
                >
                  ×
                </button>
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div
        *ngIf="isLoading"
        class="min-h-[400px] flex items-center justify-center"
      >
        <!-- ... votre code loading existant ... -->
      </div>

      <!-- Content -->
      <div *ngIf="!isLoading" class="min-h-screen bg-slate-50">
        <div
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
        >
          <app-product-card
            *ngFor="let product of filteredProducts"
            [product]="product"
          >
          </app-product-card>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredProducts.length === 0" class="text-center py-16">
          <div class="max-w-md mx-auto">
            <div *ngIf="logoUrl" class="flex items-center">
              <img
                [src]="logoUrl"
                [alt]="configService.getSetting('site_name') || 'La Brocante'"
                class="h-10 w-10 md:h-10 md:w-10 object-contain"
              />
            </div>
            <div
              *ngIf="!logoUrl"
              class="flex items-center justify-center w-full"
            >
              <svg
                class="h-6 w-6 md:h-8 md:w-8 text-blue-600"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <!-- MODIFICATION: Titre vide dynamique -->
            <h3 class="text-xl font-semibold text-slate-900 mb-2">
              {{
                configService.getSetting("no_products_title") ||
                  "Aucun trésor trouvé"
              }}
            </h3>

            <!-- MODIFICATION: Message vide dynamique -->
            <p class="text-slate-600">
              {{
                searchQuery || selectedCategory !== "Tous"
                  ? configService.getSetting("no_products_filtered") ||
                    "Essayez de modifier vos critères de recherche."
                  : configService.getSetting("no_products_available") ||
                    "La collection sera bientôt disponible !"
              }}
            </p>
          </div>
        </div>
      </div>

      <!-- Message si vide (fallback) -->
      <div
        *ngIf="products.length === 0 && !isLoading && !error"
        class="text-center py-12"
      >
        <!-- MODIFICATION: Message par défaut dynamique -->
        <p class="text-slate-600 text-lg">
          {{
            configService.getSetting("no_products_default") ||
              "Aucun produit disponible pour le moment."
          }}
        </p>
      </div>

      <!-- Error State -->
      <div
        *ngIf="error && !isLoading"
        class="min-h-[400px] flex items-center justify-center"
      >
        <div
          class="text-center max-w-md mx-auto p-6 bg-red-50 rounded-lg border border-red-200"
        >
          <div class="text-4xl mb-4">⚠️</div>
          <!-- MODIFICATION: Titre erreur dynamique -->
          <h3 class="text-lg font-semibold text-red-800 mb-2">
            {{ configService.getSetting("error_title") || "Oups !" }}
          </h3>

          <!-- MODIFICATION: Message erreur dynamique -->
          <p class="text-red-600 mb-4">{{ error }}</p>

          <button
            (click)="loadData()"
            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors"
          >
            <!-- MODIFICATION: Bouton réessayer dynamique -->
            {{ configService.getSetting("retry_button") || "Réessayer" }}
          </button>
        </div>
      </div>
    </main>
  </div>
</app-public-layout>
